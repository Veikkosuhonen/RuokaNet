{% extends "layout.html" %}
{% block title %}{{ shop[1] }}{% endblock %}
{% block header %}{{ shop[1] }}{% endblock %}
{% block content %}
<div class="container">
    <div class="row p-4 bg-light border-2 border-bottom rounded-bottom shadow-sm">
        <div class="col-2">
            <img src="/static/img/vm.png" class="img-fluid rounded" style="object-fit: fill; width: 100%; height: 100%; image-rendering: crisp-edges;">
        </div>
        <div class="col align-self-end p-2 border-bottom">
            <h1 class="display-1">{{ shop[1] }}</h1>
            <small class="text-muted">Owners: </small>
            {% for owner in owners %}<a href="users/{{owner[1]}}" class="text-muted">{{owner[1]}}</a> {% endfor %}
        </div>
    </div>

    <div class="container p-2 mt-3 border rounded">
        <h3>Products</h3>

    {% for product in products %}
    <div class="row mx-auto p-1 border rounded mb-3">
        <div class="col p-2 border-end">
            <span class="text-muted">item: </span>{{product[1]}}
        </div>
        <div class="col p-2 border-end">
            <span class="text-muted">price: </span>{{product[2]}}
        </div>
        <div class="col p-2 border-end">
            {{product[3]}}<span class="text-muted"> in stock</span>
        </div>
        {% if isowner %}
        <div class="col border-end">
            <form action="/shops/{{shop[0]}}/products/{{product[0]}}" method="POST" class="row">
                <label class="col-auto col-form-label">Update price</label>
                <input type="number" ,="" name="newprice" value="{{product[2]}}" class="form-control col">
                <input type="submit" value="update" class="form-control btn btn-outline-primary col mx-2">
            </form>
        </div>
        <div class="col-auto">
            <form action="/shops/{{ shop[0] }}/produce/{{ product[0] }}" method="POST" class="row">
                <div class="col">
                    <input type="submit" value="produce" class="form-control btn btn-primary">
                </div>
            </form>
        </div>
        {% elif session.username %}
        <div class="col-auto">
            <form action="/shops/{{ shop[0] }}/buy/{{ product[0] }}" method="POST" class="row">
                <div class="col">
                    <input type="submit" value="buy" class="form-control btn btn-primary {% if product[3] == 0%}disabled{% endif %}">
                </div>
            </form>
        </div>
        {% endif %}
    </div>
    {% endfor %}

    {% if isowner %}
    <div class="row mx-auto border rounded mb-2">
        <div class="col align-self-start">
            <div class="row mb-1 bg-light text-muted border-bottom rounded-top">
                <small>Add new product</small>
            </div>
            <form action="/shops/{{shop[0]}}/addproduct" method="POST" class="row p-2">
                <input type="text" name="itemname" value="" placeholder="item" class="form-control col mx-2">
                <input type="number" name="price" value="" placeholder="price" class="form-control col p-2 border-end">
                <input type="submit" value="add" class="form-control btn btn-primary col mx-2">
            </form>
        </div>
    </div>
    {% endif %}

    </div>
    {% if isowner %}
    <p>Add a new product</p><br>
    <form action="/shops/{{ shop[0] }}/addproduct" method="POST">
        <p>Item</p><br>
        {% for item in items %}
        {{ item[1] }} <input type="radio" name="itemid" value="{{ item[0] }}"><br>
        {% endfor %}
        <p>Price</p><br>
        <input type="number" name="price">
        <input type="submit" value="add">
    </form>
    <hr>
    <p>Invite users</p><br>
    <form action="/shops/{{ shop[0] }}/inviteuser" method="POST">
        <input type="text" name="receivername">
        <input type="submit" value="invite">
    </form>
    <p>Leave this shop</p>
    <form action="/shops/{{ shop[0] }}/leave" method="POST">
        <input type="submit" value="Leave">
    </form>
    {% endif %}
</div>
{% endblock %}